# WARNING. DO NOT EDIT THIS FILE.
# To override settings from this file, you can copy and paste the relevant
# sections into your printer.cfg and change it there.

#####
# INCLUDE IDEX MACRO FILES
#####
[include ../../macros/idex/*.cfg]

[gcode_macro _VAOC]
variable_is_fixed: False                    # true  = VAOC camera is fixed on the printer

[delayed_gcode _IDEX_INIT]
initial_duration: 0.1
gcode:
	ENABLE_DEBUG
  # ensure IDEX homing order
  SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=home_y_first VALUE=True
  # ensure inverted hybrid corexy configuration
	VERIFY_HYBRID_INVERTED

# Print macros. Call these from your slicer (custom g-code). 
# You can copy these to printer.cfg and modify them to your liking, or just use them as is.
# Read more here: https://rat-rig.github.io/V-CoreOS/#/slicers

# Macro to perform a modified z_tilt supporting stowable probes
[gcode_macro Z_TILT_ADJUST]
rename_existing: Z_TILT_ADJUST_ORIG
gcode:
	# beacon contact config
	{% set beacon_contact_z_tilt_adjust_samples = printer["gcode_macro RatOS"].beacon_contact_z_tilt_adjust_samples|default(2)|int %}
	{% set beacon_contact_z_tilt_adjust = true if printer["gcode_macro RatOS"].beacon_contact_z_tilt_adjust|default(false)|lower == 'true' else false %}

	# set IDEX single mode
	{% if printer["dual_carriage"] is defined %}
		# cache current IDEX mode
		{% set idex_mode = printer["dual_carriage"].carriage_1|lower %}
		# reset IDEX mode
		_IDEX_SINGLE
		# select default toolhead
		_SELECT_TOOL T={printer["gcode_macro RatOS"].default_toolhead|default(0)|int} TOOLSHIFT=false
	{% endif %}

	# Z-Zilt Adjust
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
		DEPLOY_PROBE
	{% endif %}
	{% if printer.configfile.settings.beacon is defined and beacon_contact_z_tilt_adjust %}
		Z_TILT_ADJUST_ORIG PROBE_METHOD=contact SAMPLES={beacon_contact_z_tilt_adjust_samples}
	{% else %}
		Z_TILT_ADJUST_ORIG
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
		STOW_PROBE
	{% endif %}

	# restore IDEX mode
	{% if printer["dual_carriage"] is defined %}
		{% if idex_mode == "copy" %}
			_IDEX_COPY
		{% elif idex_mode == "mirror" %}
			_IDEX_MIRROR
		{% endif %}
	{% endif %}
